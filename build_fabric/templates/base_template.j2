hostname {{ inventory_hostname }}
vdc {{ inventory_hostname }} id 1
  limit-resource vlan minimum 16 maximum 4094
  limit-resource vrf minimum 2 maximum 4096
  limit-resource port-channel minimum 0 maximum 511
  limit-resource u4route-mem minimum 248 maximum 248
  limit-resource u6route-mem minimum 96 maximum 96
  limit-resource m4route-mem minimum 58 maximum 58
  limit-resource m6route-mem minimum 8 maximum 8

feature nxapi
feature scp-server
feature tacacs+
cfs eth distribute
nv overlay evpn
feature ospf
feature bgp
feature fabric forwarding
feature interface-vlan
feature vn-segment-vlan-based
feature lacp
feature vpc
feature lldp
feature bfd
clock timezone GMT 0 0
clock summer-time BST 5 sun mar 02:00 5 sun oct 02:00 60
feature nv overlay

{# Username and authetication based settings #}
no password strength-check
{% for usr in bse.users %}
username {{ usr.username }} password 5 {{ usr.password }} role {{ usr.role }}
{% endfor %}
ip domain-lookup
ip domain-name {{ bse.services.domain }}
ip name-server {{ bse.services.dns.prim }} {{ bse.services.dns.sec }}
tacacs-server key 7 {{ bse.services.tacacs.key }}
{% for srv in bse.services.tacacs.servers %}
tacacs-server host {{ srv }}
{% endfor %}
aaa group server tacacs+ {{ bse.services.tacacs.grp_name }}
{% for srv in bse.services.tacacs.servers %}
    server {{ srv }}
{% endfor %}
    source-interface {{ bse.services.src_int }}
crypto key param rsa label {{ inventory_hostname }}.{{ bse.services.domain }} modulus 2048
system default switchport shutdown
logging message interface type ethernet description
{# Managment access-lists #}
ip access-list {{ bse.acl.snmp.name }}
{# The start sequence number that has 10 added to it with each loop iteration #}
{% set seq = namespace(cnt=10) %}
{% for host in bse.acl.snmp.source %}
  {{ seq.cnt }} permit {{ bse.acl.snmp.port[0] }} {{ host }} any
{% set seq.cnt= seq.cnt + 10 %}
{% endfor %}
  {{ seq.cnt }} deny ip any any log
ip access-list {{ bse.acl.ssh.name }}
{% set seq = namespace(cnt=10) %}
{% for host in bse.acl.ssh.source %}
  {{ seq.cnt }} permit {{ bse.acl.ssh.port[0] }} {{ host }} any
{% set seq.cnt= seq.cnt + 10 %}
{% endfor %}
  {{ seq.cnt }} deny ip any any log
snmp-server source-interface traps {{ bse.services.src_int }}
snmp-server source-interface informs {{ bse.services.src_int }}
snmp-server user admin network-admin auth md5 0x99187947008c0a20401eac07e9fb58c3 priv 0x99187947008c0a20401eac07e9fb58c3 localizedkey
snmp-server host {{ bse.services.snmp.host }} traps version 2c {{ bse.services.snmp.comm }}
rmon event 1 description FATAL(1) owner PMON@FATAL
rmon event 2 description CRITICAL(2) owner PMON@CRITICAL
rmon event 3 description ERROR(3) owner PMON@ERROR
rmon event 4 description WARNING(4) owner PMON@WARNING
rmon event 5 description INFORMATION(5) owner PMON@INFO
snmp-server community {{ bse.services.snmp.comm }} group network-operator
snmp-server community {{ bse.services.snmp.comm }} use-ipv4acl {{ bse.acl.snmp.name }}
{% for ntp in bse.services.ntp.server %}
ntp server {{ ntp }} use-vrf default
{% endfor %}
ntp source-interface {{ bse.services.src_int }}
aaa authentication login default group {{ bse.services.tacacs.grp_name }}
aaa authentication login console local
aaa authorization commands default group {{ bse.services.tacacs.grp_name }} local
aaa accounting default group {{ bse.services.tacacs.grp_name }}
aaa authentication login error-enable

vlan 1

vrf context management
  ip route 0.0.0.0/0 10.10.108.1

interface Vlan1

interface Ethernet1/1

interface Ethernet1/2

interface Ethernet1/3

interface Ethernet1/4

interface Ethernet1/5

interface Ethernet1/6

interface Ethernet1/7

interface Ethernet1/8

interface Ethernet1/9

interface Ethernet1/10

interface Ethernet1/11

interface Ethernet1/12

interface Ethernet1/13

interface Ethernet1/14

interface Ethernet1/15

interface Ethernet1/16

interface Ethernet1/17

interface Ethernet1/18

interface Ethernet1/19

interface Ethernet1/20

interface Ethernet1/21

interface Ethernet1/22

interface Ethernet1/23

interface Ethernet1/24

interface Ethernet1/25

interface Ethernet1/26

interface Ethernet1/27

interface Ethernet1/28

interface Ethernet1/29

interface Ethernet1/30

interface Ethernet1/31

interface Ethernet1/32

interface Ethernet1/33

interface Ethernet1/34

interface Ethernet1/35

interface Ethernet1/36

interface Ethernet1/37

interface Ethernet1/38

interface Ethernet1/39

interface Ethernet1/40

interface Ethernet1/41

interface Ethernet1/42

interface Ethernet1/43

interface Ethernet1/44

interface Ethernet1/45

interface Ethernet1/46

interface Ethernet1/47

interface Ethernet1/48

interface Ethernet1/49

interface Ethernet1/50

interface Ethernet1/51

interface Ethernet1/52

interface Ethernet1/53

interface Ethernet1/54

interface Ethernet1/55

interface Ethernet1/56

interface Ethernet1/57

interface Ethernet1/58

interface Ethernet1/59

interface Ethernet1/60

interface Ethernet1/61

interface Ethernet1/62

interface Ethernet1/63

interface Ethernet1/64

interface Ethernet1/65

interface Ethernet1/66

interface Ethernet1/67

interface Ethernet1/68

interface Ethernet1/69

interface Ethernet1/70

interface Ethernet1/71

interface Ethernet1/72

interface Ethernet1/73

interface Ethernet1/74

interface Ethernet1/75

interface Ethernet1/76

interface Ethernet1/77

interface Ethernet1/78

interface Ethernet1/79

interface Ethernet1/80

interface Ethernet1/81

interface Ethernet1/82

interface Ethernet1/83

interface Ethernet1/84

interface Ethernet1/85

interface Ethernet1/86

interface Ethernet1/87

interface Ethernet1/88

interface Ethernet1/89

interface Ethernet1/90

interface Ethernet1/91

interface Ethernet1/92

interface Ethernet1/93

interface Ethernet1/94

interface Ethernet1/95

interface Ethernet1/96

interface Ethernet1/97

interface Ethernet1/98

interface Ethernet1/99

interface Ethernet1/100

interface Ethernet1/101

interface Ethernet1/102

interface Ethernet1/103

interface Ethernet1/104

interface Ethernet1/105

interface Ethernet1/106

interface Ethernet1/107

interface Ethernet1/108

interface Ethernet1/109

interface Ethernet1/110

interface Ethernet1/111

interface Ethernet1/112

interface Ethernet1/113

interface Ethernet1/114

interface Ethernet1/115

interface Ethernet1/116

interface Ethernet1/117

interface Ethernet1/118

interface Ethernet1/119

interface Ethernet1/120

interface Ethernet1/121

interface Ethernet1/122

interface Ethernet1/123

interface Ethernet1/124

interface Ethernet1/125

interface Ethernet1/126

interface Ethernet1/127

interface Ethernet1/128

{# Management and conole access  #}
interface mgmt0
  ip access-class {{ bse.acl.ssh.name }} in
  vrf member management
  ip address {{ ansible_host }}/{{ bse.addr.mgmt_net.split('/')[1] }}
cli alias name wr copy running-config startup-config
line console
  exec-timeout {{ bse.adv.exec_timeout.console }}
line vty
  exec-timeout {{ bse.adv.exec_timeout.vty }}
  ip access-group {{ bse.acl.ssh.name }} in
boot nxos bootflash:/{{ bse.adv.image }}

{% for log in bse.services.log.server %}
logging server {{ log }}
{% endfor %}
logging source-interface {{ bse.services.src_int }}

