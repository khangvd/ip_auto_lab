


###################### Service: Routing Protocols (border only) ######################
# This supports creation of BGP peerings or non-backbone OSPF process only on the border switches
# All BGP updates allowed in/out is done using Route-maps and prefix-lists
# Redistribution of OSPF/BGP is done using Route-maps, prefix-lists and ExtCommunity lists
# Are 3 pre-built prefix-lists that can be referenced in OSPF or BGP: ALLOW-ALL, DENY-ALL, DEFAULT
# The OSPF process is built on a VPC pair of borders with a different area created for each pair. A new SVI is created for the RID and peering between them
# Only creates the OSPF process, interfaces are added using the 'Device ports' service.

#### Base variables ####
srv_routing:
  - tenant: prod                                          # The VRF that all the routing protocols are in
    bgp:
      inet_peerings:                                      # ISP peerings which only accept a default-route in
        - name: GTT                                       # Short name used in route-maps
          remote_as: 65002
          peer_ip: 192.168.12.2
          description: GTT Internet Peering
          allowed_out: [201.76.1.144/28]   # The network/prefix (seperated by ,) advertised. Blank will allow all
          #timers: [3, 9]                                 # Uses the default of 3 and 9 unless unhased and specified
      bgp_peerings:                                       # BGP peerings which can advertise and receive anything
        - name: MS
          remote_as: 65002
          peer_ip: 192.168.12.5
          description: Microsoft Azure Peering
          allowed_in: [55.55.55.0/24, 66.66.66.0/24, 77.77.77.0/24]
          allowed_out: [DENY-ALL]
          #timers: [3, 9]
    ospf:                                             # Only creates the OSPF process, interfaces are added using the 'Device ports' service.
      - pro: 98                                       # The same process number is used on all border switches
        area: 0.0.0.1                                 # First area, so BORDER1/2 will be 0.0.0.1 and BORDER3/4 0.0.0.2
        inter_sw_vlan: 3                              # VLAN used for OSPF peering between border leafs (ip is got from base.yml)
        default_orig: no                              # Use 'yes' to advertise default route or 'always' to advertise it even if it doesnt exist
        bgp_redist_in: yes                            # Redistributes based on the tenant RT, these are the SVIs redist into BGP with a tag
        bgp_redist_out: [ALLOW-ANY]                   # The network/prefix (seperated by ,) redist into this tenant (into BGP).
  # - tenant: acme_prod                                 # Can add either protocols under a different VRF
  #   bgp:
  #     inet_peerings:
  #     bgp_peerings:
  #   ospf:

#### Advanced variables ####
srv_routing_adv:
  bgp:
    rm_in_naming: rm_name_IN                          # Naming format, name is swapped with bgp peering name. Can change but MUST still have 'name' in it
    rm_out_naming: rm_name_OUT                        # Naming format, name is swapped with bgp peering name. Can change but MUST still have 'name' in it
    pl_in_naming: pl_name_IN                          # Only created if dont use ALLOW-ALL, DENY-ALL or DEFAULT
    pl_out_naming: pl_name_OUT                        # Only created if dont use ALLOW-ALL, DENY-ALL or DEFAULT
  ospf:
    rm_in_naming: rm_BGPas>>OSPFpro                 # Naming format, 'as' is swapped for the BGP AS and 'pro' for OSPF process. Can change but MUST still have 'pro' and 'as' in it
    rm_out_naming: rm_OSPFpro>>BGPas                # Naming format, 'pro' is swapped for OSPF process and 'as' for the BGP AS. Can change but MUST still have 'pro' and 'as' in it
    cl_in_naming: cl_RT_vrf                         # Extcommity list that matches RT for that tenant (BGPAS:L3VNI), is the SVIs redist into IPv4 address family. 'vrf is subsituted for vrf
    pl_out_naming: pl_OSPFpro>>BGPas                # Only created if dont use ALLOW-ALL, DENY-ALL or DEFAULT, it again swaps 'pro' and 'as'